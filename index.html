<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Machine de Turing avec addition en JavaScript</title>
    <link rel="stylesheet" href="static/style.css" />
    <script src="static/jquery.js"></script>
    <script src="static/raphael.js"></script>
    <script src="static/joint.js"></script>
    <script src="static/turing.js"></script>
    <script>
        $(function () {
            // Graph
            var r = Raphael('canvas', 1400, 400);
            var top = 200;

            // Définition des états et des transitions
            var steps = {
                // Transitions existantes...
                's3:+': {state: 's10', value: '+', move: 'right'}, // Lecture du symbole d'addition
                's10:1': {state: 's11', value: '1', move: 'right'}, // Déplacement vers la droite pour lire le premier chiffre
                's11:1': {state: 's12', value: '1', move: 'right'}, // Déplacement vers la droite pour lire le deuxième chiffre
                's12:1': {state: 's13', value: '1', move: 'right'}, // Déplacement vers la droite pour lire le troisième chiffre (si nécessaire)
                // Logique d'addition
                's13:=': {state: 's14', value: '=', move: 'left'}, // Retour en arrière pour écrire le résultat
                's14:1': {state: 's14', value: '1', move: 'left'}, // Écriture du résultat (avec gestion de la retenue)
                // Autres transitions existantes...
            };

            // Ajout de nouveaux états pour gérer l'addition
            var s10 = r.circle(650, top + 0, 20);
            s10.node.setAttribute('class', 'state s10');
            var t10 = r.text(650, top + 0, "s10").attr({ "font-size": 15});
            t10.node.setAttribute('class', 'text s10');

            var s11 = r.circle(800, top + 0, 20);
            s11.node.setAttribute('class', 'state s11');
            var t11 = r.text(800, top + 0, "s11").attr({ "font-size": 15});
            t11.node.setAttribute('class', 'text s11');

            var s12 = r.circle(950, top + 0, 20);
            s12.node.setAttribute('class', 'state s12');
            var t12 = r.text(950, top + 0, "s12").attr({ "font-size": 15});
            t12.node.setAttribute('class', 'text s12');

            var s13 = r.circle(1100, top + 0, 20);
            s13.node.setAttribute('class', 'state s13');
            var t13 = r.text(1100, top + 0, "s13").attr({ "font-size": 15});
            t13.node.setAttribute('class', 'text s13');

            var s14 = r.circle(1100, top + 160, 20);
            s14.node.setAttribute('class', 'state s14');
            var t14 = r.text(1100, top + 160, "s14").attr({ "font-size": 15});
            t14.node.setAttribute('class', 'text s14');

            // Initialisation de la machine de Turing avec les transitions mises à jour
            var turing = new Turing(steps, 's1', 's8');
            turing.tape = ['1', '1', '1', '+', '1', '1', '=']; // Exemple d'addition à effectuer
            turing.calc = '3 + 2 ='; // Expression d'addition
            turing.reset();

            // Gestion des boutons d'action
            $('#run').click(function () {
                turing.run();
            });

            $('#step').click(function () {
                turing.step();
            });

            $('#reset').click(function () {
                turing.reset();
            });

            $('#calc').click(function () {
                var calc = prompt('Veuillez entrer une nouvelle addition (par exemple, 3 + 2):');
                if (calc) {
                    var match = calc.match(/([0-9]+)[ ]*\+[ ]*([0-9]+)/i);
                    if (match) {
                        var first = parseInt(match[1]), second = parseInt(match[2]);
                        var tape = [];
                        var i = 0;
                        if (0 == first) {
                            tape[i++] = '0';
                        } else {
                            for ( ; i < first; i++) {
                                tape[i] = '1';
                            }
                        }
                        tape[i++] = '+';
                        if (0 == second) {
                            tape[i++] = '0';
                        } else {
                            for (var end = second + i; i < end; i++) {
                                tape[i] = '1';
                            }
                        }
                        tape[i++] = '=';
                        turing.tape = tape;
                        turing.calc = first + ' + ' + second + ' =';
                        turing.reset();
                    } else {
                        alert('Désolé, saisie invalide !');
                    }
                }
            });
        });
    </script>
</head>
<body>

    <ol class="turing"></ol>
    
    <div class="container">
        <div class="actions">
            <h2>Actions</h2>
            <p>
                <input id="run" type="button" value="Exécuter" />
                <input id="step" type="button" value="Étape suivante" />
                <input id="reset" type="button" value="Réinitialiser" />
            </p>
        </div>
        <div class="count">
            <h2>Compteur</h2>
            <p id="count"></p>
        </div>
        <div class="state">
            <h2>État</h2>
            <p id="state"></p>
        </div>
        <div class="calc">
            <h2>Calcul</h2>
            <p id="calc"></p>
        </div>

        <div id="canvas"></div>
    </div>
</body>
</html>
